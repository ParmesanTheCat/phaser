<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    class Example extends Phaser.Scene
    {
        preload ()
        {
            this.load.image('ruins', 'the-ruins-undertale-pixel-thumb.jpg'); // Ensure the image is in the same directory
            this.load.image('parm', 'parm.png'); // Ensure the image is in the same directory
            this.load.image('wire', 'Subject.png'); // Ensure the image is in the same directory
        }

        create ()
        {
            // Add the background image as a tile sprite
            this.background = this.add.tileSprite(0, 0, this.sys.game.config.width, this.sys.game.config.height, 'ruins');
            this.background.setOrigin(0, 0);

            // Add the movable object
            this.parm = this.physics.add.image(100, 480, 'parm'); // Add the image to the scene
            this.parm.setScale(0.062); // Scale down the image
            this.parm.setCollideWorldBounds(true); // Prevent the object from going out of bounds

            // Set the initial velocity to move right automatically
            this.parm.setVelocityX(3);

            // Create cursor keys
            this.cursors = this.input.keyboard.createCursorKeys();

            // Add spacebar key
            this.spacebar = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

            // Create a group for wires
            this.wire = this.physics.add.group();

            // Spawn wires at intervals
            this.time.addEvent({
                delay: 700, // Adjust the delay as needed
                callback: this.spawnWire,
                callbackScope: this,
                loop: true
            });

            // Create a text box in the top-left corner
            this.score = 0;
            this.scoreText = this.add.text(10, 10, 'Score: 0', { fontSize: '32px', fill: '#fff' });

            // Increment the score every second
            this.scoreTimer = this.time.addEvent({
                delay: 100,
                callback: this.incrementScore,
                callbackScope: this,
                loop: true
            });

            // Add collision detection between parm and wire
            this.physics.add.collider(this.parm, this.wire, this.stopGame, null, this);
        }

        spawnWire() {
            console.log('Spawning wire'); // Debugging: Check if this function is called
            const x = Phaser.Math.Between(20, this.sys.game.config.width); // Random x position
            //const y = Phaser.Math.Between(, this.sys.game.config.height); // Random y position
            const wire = this.wire.create(x, 60, 'wire'); // Spawn wire at the random position
            wire.setVelocityX(-350); // Move wire to the left
            wire.setScale(0.06); // Scale down the wire further
            wire.setCollideWorldBounds(true); // Prevent the wire from going out of bounds
            wire.body.onWorldBounds = true; // Enable world bounds collision
            wire.body.world.on('worldbounds', (body) => {
                if (body.gameObject === wire) {
                    wire.destroy(); // Destroy the wire when it goes out of bounds
                }
            });
        }

        incrementScore() {
            this.score += 1;
            this.scoreText.setText('Score: ' + this.score);
        }

        stopGame(parm, wire) {
            this.physics.pause(); // Stop all physics
            this.scoreTimer.remove(); // Stop the score timer
            parm.setTint(0xff0000); // Change parm color to red
            parm.anims.play('turn'); // Play turn animation (if any)
        }

        update ()
        {
            // Ensure parm keeps moving to the right
            this.parm.setVelocityX(3);

            // Reset vertical velocity
            this.parm.setVelocityY(0);

            // Move up
            if (this.cursors.up.isDown) {
                this.parm.setVelocityY(-300);
            }
            // Move down
            else if (this.cursors.down.isDown) {
                this.parm.setVelocityY(300);
            }
            // Move left
            if (this.cursors.left.isDown) {
                this.parm.setVelocityX(-300);
            }
            // Move right
            else if (this.cursors.right.isDown) {
                this.parm.setVelocityX(300);
            }

            // Jump when spacebar is pressed
            if (Phaser.Input.Keyboard.JustDown(this.spacebar)) {
                this.parm.setVelocityY(-300); // Adjust the jump velocity as needed
            }

            // Scroll the background continuously
            this.background.tilePositionX += 2; // Adjust the speed as needed
        }
    }

    const config = {
        type: Phaser.AUTO,
        width: 1200,
        height: 600,
        scene: Example,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 500 } // Set gravity
            }
        }
    };

    const game = new Phaser.Game(config);
    </script>

</body>
</html>